<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—å•†ç†±éŸ³ç¤¾ç·´åœ˜å®¤ç³»çµ±</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-guitar"></i> åŒ—å•†ç†±éŸ³ç¤¾ç·´åœ˜å®¤ç³»çµ±</h1>
            <p>ç®¡ç†å¾Œå° - éƒµä»¶æœå‹™æ¸¬è©¦</p>
        </header>

        <div class="dashboard">
            <!-- ç³»çµ±ç‹€æ…‹ -->
            <div class="status-cards">
                <div class="status-card">
                    <div class="card-icon backend">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="card-info">
                        <h3>å¾Œç«¯æœå‹™</h3>
                        <p id="backend-status">æª¢æŸ¥ä¸­...</p>
                    </div>
                </div>
                <div class="status-card">
                    <div class="card-icon email">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="card-info">
                        <h3>éƒµä»¶æœå‹™</h3>
                        <p id="email-status">å¾…æ¸¬è©¦</p>
                    </div>
                </div>
            </div>

            <!-- éƒµä»¶æ¸¬è©¦å€ -->
            <div class="test-section">
                <h2><i class="fas fa-paper-plane"></i> éƒµä»¶ç™¼é€æ¸¬è©¦</h2>
                
                <div class="test-cards">
                    <!-- ç”¨æˆ¶è¨»å†Šé€šçŸ¥ -->
                    <div class="test-card">
                        <h3>ç”¨æˆ¶è¨»å†Šé€šçŸ¥</h3>
                        <p>æ¸¬è©¦æ–°ç”¨æˆ¶è¨»å†Šæ™‚ç™¼é€çµ¦ç®¡ç†å“¡çš„éƒµä»¶</p>
                        <button class="test-btn" onclick="testUserRegistration()">
                            <i class="fas fa-user-plus"></i> ç™¼é€æ¸¬è©¦
                        </button>
                    </div>

                    <!-- æ–°é ç´„é€šçŸ¥ -->
                    <div class="test-card">
                        <h3>æ–°é ç´„é€šçŸ¥</h3>
                        <p>æ¸¬è©¦ç”¨æˆ¶é ç´„ç·´åœ˜å®¤æ™‚ç™¼é€çµ¦ç®¡ç†å“¡çš„éƒµä»¶</p>
                        <button class="test-btn" onclick="testNewBooking()">
                            <i class="fas fa-calendar-plus"></i> ç™¼é€æ¸¬è©¦
                        </button>
                    </div>

                    <!-- å¯©æ ¸çµæœé€šçŸ¥ -->
                    <div class="test-card">
                        <h3>å¯©æ ¸çµæœé€šçŸ¥</h3>
                        <p>æ¸¬è©¦ç™¼é€å¸³è™Ÿå¯©æ ¸çµæœçµ¦ç”¨æˆ¶çš„éƒµä»¶</p>
                        <button class="test-btn" onclick="testApprovalResult()">
                            <i class="fas fa-check-circle"></i> ç™¼é€æ¸¬è©¦
                        </button>
                    </div>

                    <!-- é ç´„ç¢ºèªé€šçŸ¥ -->
                    <div class="test-card">
                        <h3>é ç´„ç¢ºèªé€šçŸ¥</h3>
                        <p>æ¸¬è©¦ç™¼é€é ç´„ç¢ºèªéƒµä»¶çµ¦ç”¨æˆ¶</p>
                        <button class="test-btn" onclick="testBookingConfirmation()">
                            <i class="fas fa-check-double"></i> ç™¼é€æ¸¬è©¦
                        </button>
                    </div>
                </div>
            </div>

            <!-- è‡ªè¨‚éƒµä»¶æ¸¬è©¦ -->
            <div class="custom-test">
                <h2><i class="fas fa-cog"></i> è‡ªè¨‚éƒµä»¶æ¸¬è©¦</h2>
                <div class="form-group">
                    <label for="emailType">éƒµä»¶é¡å‹:</label>
                    <select id="emailType" class="form-select">
                        <option value="user_registration">ç”¨æˆ¶è¨»å†Šé€šçŸ¥ (ç®¡ç†å“¡)</option>
                        <option value="new_booking">æ–°é ç´„é€šçŸ¥ (ç®¡ç†å“¡)</option>
                        <option value="approval_result">å¯©æ ¸çµæœé€šçŸ¥ (ç”¨æˆ¶)</option>
                        <option value="booking_confirmation">é ç´„ç¢ºèªé€šçŸ¥ (ç”¨æˆ¶)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="recipientEmail">æ”¶ä»¶äººéƒµç®±:</label>
                    <input type="email" id="recipientEmail" class="form-input" 
                           placeholder="è¼¸å…¥æ¸¬è©¦éƒµç®±åœ°å€" value="11056046@ntub.edu.tw">
                </div>
                <button class="test-btn primary" onclick="sendCustomTest()">
                    <i class="fas fa-rocket"></i> ç™¼é€è‡ªè¨‚æ¸¬è©¦éƒµä»¶
                </button>
            </div>

            <!-- çµæœé¡¯ç¤º -->
            <div class="result-section">
                <h2><i class="fas fa-list"></i> æ¸¬è©¦çµæœ</h2>
                <div id="testResults" class="results-container"></div>
            </div>
        </div>
    </div>

    <script>
// åœ¨é€™è£¡è²¼ä¸Šå®Œæ•´çš„ app.js ç¨‹å¼ç¢¼
const API_BASE_URL = 'https://ntub-band-backend-ejcjfam3g-suyi0204s-projects.vercel.app';

console.log('ğŸŒ API åŸºç¤ URL:', API_BASE_URL);

// ç³»çµ±ç‹€æ…‹æª¢æŸ¥
async function checkSystemStatus() {
    try {
        console.log('ğŸ” æª¢æŸ¥ç³»çµ±ç‹€æ…‹');
        const response = await fetch(`${API_BASE_URL}/api/health`);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        document.getElementById('backend-status').innerHTML = 
            `<span style="color: #10b981;">âœ… æ­£å¸¸é‹ä½œ</span><br>
             <small>æœå‹™: ${data.service}</small>`;
        
        document.getElementById('email-status').innerHTML = 
            `<span style="color: #10b981;">âœ… å°±ç·’</span><br>
             <small>æœå‹™: ${data.emailService || 'Resend'}</small>`;
        
        return true;
    } catch (error) {
        console.error('âŒ ç³»çµ±ç‹€æ…‹æª¢æŸ¥å¤±æ•—:', error);
        document.getElementById('backend-status').innerHTML = 
            `<span style="color: #ef4444;">âŒ é€£ç·šå¤±æ•—</span><br>
             <small>${error.message}</small>`;
        return false;
    }
}

// ç™¼é€éƒµä»¶æ¸¬è©¦
async function sendTestEmail(emailData) {
    const resultDiv = document.getElementById('testResults');
    const resultId = 'result-' + Date.now();
    
    const resultItem = document.createElement('div');
    resultItem.className = 'result-item';
    resultItem.id = resultId;
    
    const timestamp = new Date().toLocaleString('zh-TW');
    resultItem.innerHTML = `
        <div class="result-header">
            <span class="result-title">${emailData.type} - ${emailData.notification_type}</span>
            <span class="result-time">${timestamp}</span>
        </div>
        <div class="result-message">
            <i class="fas fa-spinner fa-spin"></i> ç™¼é€ä¸­...
        </div>
    `;
    
    resultDiv.insertBefore(resultItem, resultDiv.firstChild);
    
    try {
        console.log('ğŸ“§ ç™¼é€éƒµä»¶è«‹æ±‚');
        const response = await fetch(`${API_BASE_URL}/api/send-email`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(emailData)
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
            console.log('âœ… éƒµä»¶ç™¼é€æˆåŠŸ');
            resultItem.className = 'result-item success';
            resultItem.innerHTML = `
                <div class="result-header">
                    <span class="result-title">${emailData.type} - ${emailData.notification_type}</span>
                    <span class="result-time">${timestamp}</span>
                </div>
                <div class="result-message">
                    <i class="fas fa-check-circle" style="color: #10b981;"></i> 
                    éƒµä»¶ç™¼é€æˆåŠŸï¼<br>
                    <small>æ”¶ä»¶äºº: ${emailData.to}</small><br>
                    <small>è¨Šæ¯ ID: ${data.messageId}</small>
                </div>
            `;
        } else {
            throw new Error(data.error || 'ç™¼é€å¤±æ•—');
        }
        
    } catch (error) {
        console.error('âŒ éƒµä»¶ç™¼é€å¤±æ•—:', error);
        resultItem.className = 'result-item error';
        resultItem.innerHTML = `
            <div class="result-header">
                <span class="result-title">${emailData.type} - ${emailData.notification_type}</span>
                <span class="result-time">${timestamp}</span>
            </div>
            <div class="result-message">
                <i class="fas fa-exclamation-circle" style="color: #ef4444;"></i> 
                ç™¼é€å¤±æ•—: ${error.message}<br>
                <small>æ”¶ä»¶äºº: ${emailData.to}</small>
            </div>
        `;
    }
}

// æ¸¬è©¦å‡½æ•¸
function testUserRegistration() {
    const emailData = {
        to: '11056046@ntub.edu.tw',
        type: 'admin',
        notification_type: 'user_registration',
        data: {
            real_name: 'ç‹å°æ˜',
            student_id: '11056046',
            user_email: '11056046@ntub.edu.tw',
            phone: '0912-345-678',
            timestamp: new Date().toLocaleString('zh-TW')
        }
    };
    sendTestEmail(emailData);
}

function testNewBooking() {
    const emailData = {
        to: '11056046@ntub.edu.tw',
        type: 'admin',
        notification_type: 'new_booking',
        data: {
            real_name: 'ç‹å°æ˜',
            user_email: '11056046@ntub.edu.tw',
            booking_date: '2024-01-15',
            booking_time: '14:00-16:00',
            booking_type: 'å€‹äººç·´ç¿’',
            booking_name: 'å‰ä»–ç·´ç¿’',
            booking_notes: 'éœ€è¦å€Ÿç”¨éŸ³ç®±',
            timestamp: new Date().toLocaleString('zh-TW')
        }
    };
    sendTestEmail(emailData);
}

function testApprovalResult() {
    const emailData = {
        to: '11056046@ntub.edu.tw',
        type: 'user',
        notification_type: 'approval_result',
        data: {
            real_name: 'ç‹å°æ˜',
            student_id: '11056046',
            approval_status: 'approved',
            admin_notes: '',
            timestamp: new Date().toLocaleString('zh-TW')
        }
    };
    sendTestEmail(emailData);
}

function testBookingConfirmation() {
    const emailData = {
        to: '11056046@ntub.edu.tw',
        type: 'user',
        notification_type: 'booking_confirmation',
        data: {
            real_name: 'ç‹å°æ˜',
            booking_date: '2024-01-15',
            booking_time: '14:00-16:00',
            booking_type: 'å€‹äººç·´ç¿’',
            booking_name: 'å‰ä»–ç·´ç¿’',
            booking_notes: 'éœ€è¦å€Ÿç”¨éŸ³ç®±',
            booking_id: 'BK20240115001',
            timestamp: new Date().toLocaleString('zh-TW')
        }
    };
    sendTestEmail(emailData);
}

function sendCustomTest() {
    const emailType = document.getElementById('emailType').value;
    const recipientEmail = document.getElementById('recipientEmail').value;
    
    if (!recipientEmail) {
        alert('è«‹è¼¸å…¥æ”¶ä»¶äººéƒµç®±åœ°å€');
        return;
    }
    
    let emailData;
    
    switch (emailType) {
        case 'user_registration':
            emailData = {
                to: recipientEmail,
                type: 'admin',
                notification_type: 'user_registration',
                data: {
                    real_name: 'æ¸¬è©¦ç”¨æˆ¶',
                    student_id: '11000000',
                    user_email: recipientEmail,
                    phone: '09XX-XXX-XXX',
                    timestamp: new Date().toLocaleString('zh-TW')
                }
            };
            break;
            
        case 'new_booking':
            emailData = {
                to: recipientEmail,
                type: 'admin',
                notification_type: 'new_booking',
                data: {
                    real_name: 'æ¸¬è©¦ç”¨æˆ¶',
                    user_email: recipientEmail,
                    booking_date: new Date().toLocaleDateString('zh-TW'),
                    booking_time: '10:00-12:00',
                    booking_type: 'æ¸¬è©¦é ç´„',
                    booking_name: 'ç³»çµ±æ¸¬è©¦',
                    booking_notes: 'é€™æ˜¯ä¸€å°æ¸¬è©¦éƒµä»¶',
                    timestamp: new Date().toLocaleString('zh-TW')
                }
            };
            break;
            
        case 'approval_result':
            emailData = {
                to: recipientEmail,
                type: 'user',
                notification_type: 'approval_result',
                data: {
                    real_name: 'æ¸¬è©¦ç”¨æˆ¶',
                    student_id: '11000000',
                    approval_status: 'approved',
                    admin_notes: '',
                    timestamp: new Date().toLocaleString('zh-TW')
                }
            };
            break;
            
        case 'booking_confirmation':
            emailData = {
                to: recipientEmail,
                type: 'user',
                notification_type: 'booking_confirmation',
                data: {
                    real_name: 'æ¸¬è©¦ç”¨æˆ¶',
                    booking_date: new Date().toLocaleDateString('zh-TW'),
                    booking_time: '14:00-16:00',
                    booking_type: 'æ¸¬è©¦é ç´„',
                    booking_name: 'ç³»çµ±æ¸¬è©¦',
                    booking_notes: 'é€™æ˜¯ä¸€å°æ¸¬è©¦éƒµä»¶',
                    booking_id: 'TEST' + Date.now(),
                    timestamp: new Date().toLocaleString('zh-TW')
                }
            };
            break;
    }
    
    sendTestEmail(emailData);
}

// é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ åŒ—å•†ç†±éŸ³ç¤¾å‰ç«¯ä»‹é¢åˆå§‹åŒ–');
    checkSystemStatus();
    
    // æ¯30ç§’æª¢æŸ¥ä¸€æ¬¡ç³»çµ±ç‹€æ…‹
    setInterval(checkSystemStatus, 30000);
});
</script>
</body>
</html>